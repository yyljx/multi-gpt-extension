# 🤖 Multi-GPT Chrome 扩展

一键向多个 AI 平台同步发送问题，支持登录状态管理和回复检测。

## ✨ 功能特性

- 🚀 **一键同步**：同时向 8 个 AI 平台发送问题
- 🖼️ **图片上传**：支持 Ctrl+V 粘贴或上传图片（部分平台）
- 🔍 **回复检测**：自动监测各平台回复完成状态
- 🔐 **登录管理**：记录登录方式，跨平台复用提示
- 📊 **状态追踪**：Badge 显示发送进度

## 📦 支持的平台

### 无需登录
- 🔍 **秘塔搜索** (metaso.cn)
- 🌐 **通义千问** (qianwen.com)

### 需要登录
- 💬 **ChatGPT** (chatgpt.com) - 🖼️ 支持图片上传（需 GPT-4 或 Plus 订阅）
- ✨ **Gemini** (gemini.google.com) - 🖼️ 支持图片上传
- 🌙 **Kimi** (www.kimi.com) - 🖼️ 支持图片上传
- 🌊 **DeepSeek** (chat.deepseek.com) - 🖼️ 支持图片上传（上传时自动关闭联网搜索）
- 💎 **腾讯元宝** (yuanbao.tencent.com) - 🖼️ 支持图片上传
- 🫛 **豆包** (doubao.com) - 🖼️ 支持图片上传
- 🌐 **通义千问** (qianwen.com) - 🖼️ 支持图片上传

## 🛠️ 安装方法

### 开发者模式安装

1. 打开 Chrome，访问 `chrome://extensions/`
2. 右上角开启 **开发者模式**
3. 点击 **加载已解压的扩展程序**
4. 选择 `multi_gpt_extension` 文件夹
5. 扩展图标会出现在工具栏

## 📖 使用说明

### 基本使用

1. 点击工具栏中的扩展图标
2. 在输入框中输入问题
3. （可选）上传图片：
   - 使用 `Ctrl + V` 粘贴剪贴板中的图片
   - 点击 📎 上传按钮选择图片文件
4. 勾选要发送的平台
5. 点击 **发送到选中平台**
6. 扩展会自动打开各平台标签页并发送问题

### 快捷键

- `Ctrl + Enter`：快速发送
- `Ctrl + V`：粘贴图片（在输入框中）

### 图片上传说明

**支持图片的平台：**
- ✅ ChatGPT（需要 GPT-4 或 Plus 订阅）
- ✅ Gemini（免费版也支持）
- ✅ Kimi
- ✅ DeepSeek（上传图片时自动关闭联网搜索）
- ✅ 通义千问
- ✅ 豆包
- ✅ 元宝

**不支持图片的平台：**
- ❌ 秘塔搜索（搜索引擎，不支持图片）

向不支持图片的平台发送时，扩展会自动忽略图片，仅发送文字内容。

### 登录建议

扩展会记录你在各平台使用的登录方式（如 Google、微信、手机号等），当你需要登录新平台时，会提示你使用相同方式以节省时间。

## ⚙️ 技术架构

```
multi_gpt_extension/
├── manifest.json          # 扩展配置 (Manifest V3)
├── popup/                  # 弹出界面
│   ├── popup.html
│   ├── popup.css
│   └── popup.js
├── background/             # 后台服务
│   └── service-worker.js
├── platforms/              # 各平台适配脚本
│   ├── chatgpt.js
│   ├── gemini.js
│   ├── deepseek.js
│   ├── qianwen.js
│   ├── kimi.js
│   ├── metaso.js
│   ├── yuanbao.js
│   └── doubao.js
└── icons/                  # 图标
```

## ⚠️ 注意事项

1. **首次使用**：需要先在浏览器中手动登录各 AI 平台
2. **平台更新**：如果某平台界面更新，可能需要更新对应的选择器
3. **验证码**：部分平台可能出现 Cloudflare 验证，需手动通过
4. **图片上传**：仅部分平台支持，详见"支持的平台"章节

## 🔧 故障排除

### 问题：某平台发送失败

1. 确认该平台已登录
2. 刷新平台页面后重试
3. 检查控制台是否有错误信息（F12 → Console）

### 问题：回复检测不准确

回复检测基于 DOM 变化监听，部分平台可能需要调整选择器。可在对应的 `platforms/*.js` 文件中修改 `SELECTORS` 配置。

## 🧪 开发与测试

### 运行测试

```bash
# 安装依赖
npm install

# 运行测试
npm test
```

### 测试说明

测试使用 Puppeteer 在真实 Chrome 环境中加载扩展进行端到端测试。

**测试覆盖：**
- ✅ 新建标签页正确加入分组
- ✅ 复用标签页保持原位置不变
- ✅ 仅在当前窗口查找标签页
- ✅ Pinned 标签页不被复用

### 已知限制

1. **扩展重载后任务丢失**：`activeTasks` 存储在内存中，扩展更新或重载后会丢失当前任务状态
2. **测试需要 headed 模式**：Chrome 扩展测试需要在有头模式下运行（`headless: false`）

## 📝 更新日志

### v1.2.0
- 扩展图片上传支持到更多平台：DeepSeek、通义千问、豆包、元宝
- DeepSeek 上传图片时自动关闭联网搜索功能
- 修复 Kimi URL 为 www.kimi.com
- **修复图片上传 "user activation" 错误**：重构上传逻辑，不再触发 file chooser 对话框

### v1.1.0
- 新增图片上传功能（支持 ChatGPT、Gemini、Kimi）
- 新增 Ctrl+V 粘贴图片
- 新增图片预览和删除功能

### v1.0.0
- 初始版本
- 支持 8 个 AI 平台
- 登录状态检测和记录
- 回复完成检测

---

*由 Antigravity 协助开发*
